{"version":3,"sources":["../../src/di/Injector.js"],"names":[],"mappings":";;;;;;;;;;;;sBACmB,UAAU;;;;gCACJ,qBAAqB;;;;6BACxB,kBAAkB;;;;yCACf,+BAA+B;;;;4CAC5B,kCAAkC;;;;4CACnC,kCAAkC;;;;IAExC,QAAQ;AAMd,aANM,QAAQ,CAMb,OAAO,EAAE;8BANJ,QAAQ;;AAOrB,YAAI,CAAC,OAAO,GAAG,uBAAuB,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;AAC3D,YAAI,CAAC,aAAa,GAAG,EAAE,CAAC;AACxB,YAAI,CAAC,gBAAgB,GAAG,EAAE,CAAC;AAC3B,uBAAe,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;KACjC;;iBAXgB,QAAQ;;eAatB,aAAC,IAAQ,EAAE;AACV,mBAAO,IAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;SAC1B;;;eAEe,0BAAC,YAAY;AACzB,gBAAI,OAAO,GAAG,uBAAuB,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;AAC/D,iBAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC1C,uBAAO,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;aACjC;AACD,mBAAO,IAAI,QAAQ,CAAC,OAAO,CAAC,CAAC;SAChC;;;WAvBgB,QAAQ;;;qBAAR,QAAQ;;AA0B7B,SAAS,IAAG,CAAC,cAAkB,EAAE,QAAiB;UAAjB,QAAiB,YAAR,QAAQ,qGAAjB,QAAiB,qBAAjB,QAAiB,sBAAjB,QAAiB,eAAjB,QAAiB,2BAAjB,QAAiB;;AAC9C,QAAI,cAAc,KAAK,SAAS,EAAE;AAC9B,cAAM,KAAK,CAAC,uCAAuC,CAAC,CAAC;KACxD;AACD,QAAI,cAAc,KAAK,QAAQ,EAAE;AAC7B,eAAO,QAAQ,CAAC;KACnB;AACD,QAAI,gBAAgB,CAAC,QAAQ,CAAC,aAAa,EAAE,cAAc,CAAC,EAAE;AAC1D,cAAM,KAAK,CAAC,qBAAqB,CAAC,CAAC;KACtC;AACD,YAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;;AAE5C,QAAI,OAAO,GAAG,oBAAoB,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;AAC7D,QAAI,OAAO,KAAK,SAAS,EAAE;AACvB,YAAI,QAAQ,CAAC,gBAAgB,CAAC,cAAc,CAAC,EAAE;AAC3C,mBAAO,GAAG,QAAQ,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;SACvD,MAAM;AACH,mBAAO,GAAG,qBAAqB,CAAC,cAAc,CAAC,CAAC;AAChD,oBAAQ,CAAC,gBAAgB,CAAC,cAAc,CAAC,GAAG,OAAO,CAAC;SACvD;KACJ;AACD,WAAO,GAAG,wBAAwB,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;AACtD,QAAI,QAAQ,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;AAC7C,YAAQ,CAAC,aAAa,CAAC,GAAG,EAAE,CAAC;AAC7B,WAAO,QAAQ,CAAC;CACnB;;AAED,SAAS,eAAe,CAAC,OAAqB;uBAArB,OAAqB,iGAArB,OAAqB,qBAArB,OAAqB,sBAArB,OAAqB,eAArB,OAAqB,2BAArB,OAAqB;;AAC1C,SAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACrC,YAAI,EAAE,OAAO,CAAC,CAAC,CAAC,gCAAkB,AAAC,EAAE;AACjC,kBAAM,KAAK,CAAC,gDAAgD,CAAC,CAAC;SACjE;KACJ;CACJ;AACD,SAAS,uBAAuB,CAAC,OAAO,EAAE,IAAI,EAAE;AAC5C,QAAI,OAAO,YAAY,KAAK,EAAE;AAC1B,eAAO,OAAO,CAAC;KAClB,MAAM;AACH,YAAI,IAAI,GAAG,EAAE,CAAC;AACd,aAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAClC,gBAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;SACtB;AACD,eAAO,IAAI,CAAC;KACf;CACJ;;AAED,SAAS,oBAAoB,CAAC,IAAI,EAAE,QAAiB;UAAjB,QAAiB,YAAR,QAAQ,qGAAjB,QAAiB,qBAAjB,QAAiB,sBAAjB,QAAiB,eAAjB,QAAiB,2BAAjB,QAAiB;;AACjD,SAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC9C,YAAI,MAAM,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;AACjC,YAAI,OAAO,GAAG,MAAM,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;AAC7C,YAAI,OAAO,EAAE;AACT,mBAAO,OAAO,CAAC;SAClB;KACJ;AACD,WAAO,SAAS,CAAC;CACpB;;AAED,SAAS,wBAAwB,CAAC,OAAO,EAAE,QAAiB;UAAjB,QAAiB,YAAR,QAAQ,qGAAjB,QAAiB,qBAAjB,QAAiB,sBAAjB,QAAiB,eAAjB,QAAiB,2BAAjB,QAAiB;;AACxD,QAAI,CAAC,OAAO,CAAC,KAAK,8CAAmB,IAAI,8BAA8B,CAAC,OAAO,CAAC,8CAAmB,CAAA,IAAK,EAAE,OAAO,CAAC,OAAO,sDAA2B,AAAC,EAAE;AACnJ,eAAO,CAAC,OAAO,GAAG,8CAAoB,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;KACxE;AACD,WAAO,OAAO,CAAC;CAClB;;AAED,SAAS,8BAA8B,CAAC,OAAO,EAAE;AAC7C,QACI,OAAO,CAAC,OAAO,CAAC,QAAQ,IACxB,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,IAChC,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,EAAE;AACxC,eAAO,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC;KACjD,MAAM;AACH,eAAO,SAAS,CAAC;KACpB;CACJ;;AAED,SAAS,qBAAqB,CAAC,IAAI,EAAE;AACjC,QAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;AAC1B,cAAM,IAAI,KAAK,CAAC,wCAAwC,GAAG,IAAI,GAAG,IAAI,GAClE,sFAAsF,GACtF,+DAA+D,CAAC,CAAC;KACxE;AACD,WAAO;AACH,eAAO,EAAG,2CAAiB,IAAI,CAAC;KACnC,CAAC;CACL;;AAED,SAAS,gBAAgB,CAAC,IAAe,EAAE,IAAQ;uBAAzB,IAAe,8FAAf,IAAe,qBAAf,IAAe,sBAAf,IAAe,eAAf,IAAe,2BAAf,IAAe;;AACrC,SAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAClC,YAAI,IAAI,CAAC,CAAC,CAAC,KAAK,IAAI,EAAE;AAClB,mBAAO,IAAI,CAAC;SACf;KACJ;AACD,WAAO,KAAK,CAAC;CAChB","file":"Injector.js","sourcesContent":["/* @flow */\nimport Module from './Module';\nimport Instantiator from './util/Instantiator';\nimport Validator from './util/Validator';\nimport ClassBinding from './bindings/types/ClassBinding';\nimport InstanceBinding from './bindings/types/InstanceBinding';\nimport SingletonScope from './bindings/scopes/SingletonScope';\n\nexport default class Injector {\n\n    modules:Array<Module>;\n    injectorStack:Array<any>;\n    implicitBindings:Object;\n\n    constructor(modules) {\n        this.modules = getModulesFromArguments(modules, arguments);\n        this.injectorStack = [];\n        this.implicitBindings = {};\n        validateModules(this.modules);\n    }\n\n    get(type:any) {\n        return get(type, this);\n    }\n\n    getChildInjector(childModules):Injector {\n        var modules = getModulesFromArguments(childModules, arguments);\n        for (var i = 0; i < this.modules.length; i++) {\n            modules.push(this.modules[i]);\n        }\n        return new Injector(modules);\n    }\n}\n\nfunction get(typeOrTypeName:any, injector:Injector) {\n    if (typeOrTypeName === undefined) {\n        throw Error('Injector.get() requires one argument.');\n    }\n    if (typeOrTypeName === Injector) {\n        return injector;\n    }\n    if (listContainsType(injector.injectorStack, typeOrTypeName)) {\n        throw Error('Circular injection.');\n    }\n    injector.injectorStack.push(typeOrTypeName);\n\n    var binding = findBindingInModules(typeOrTypeName, injector);\n    if (binding === undefined) {\n        if (injector.implicitBindings[typeOrTypeName]) {\n            binding = injector.implicitBindings[typeOrTypeName];\n        } else {\n            binding = createImplicitBinding(typeOrTypeName);\n            injector.implicitBindings[typeOrTypeName] = binding;\n        }\n    }\n    binding = updateBindingIfSingleton(binding, injector);\n    var instance = binding.binding.get(injector);\n    injector.injectorStack.pop();\n    return instance;\n}\n\nfunction validateModules(modules:Array<Module>) {\n    for (var i = 0; i < modules.length; i++) {\n        if (!(modules[i] instanceof Module)) {\n            throw Error('Injector() can only take modules as arguments.');\n        }\n    }\n}\nfunction getModulesFromArguments(modules, args) {\n    if (modules instanceof Array) {\n        return modules;\n    } else {\n        var list = [];\n        for (var i = 0; i < args.length; i++) {\n            list.push(args[i]);\n        }\n        return list;\n    }\n}\n\nfunction findBindingInModules(type, injector:Injector) {\n    for (var i = 0; i < injector.modules.length; i++) {\n        var module = injector.modules[i];\n        var binding = module.getBindingForType(type);\n        if (binding) {\n            return binding;\n        }\n    }\n    return undefined;\n}\n\nfunction updateBindingIfSingleton(binding, injector:Injector) {\n    if ((binding.scope === SingletonScope || getDecoratedBindingFromBinding(binding) === SingletonScope) && !(binding.binding instanceof InstanceBinding)) {\n        binding.binding = new InstanceBinding(binding.binding.get(injector));\n    }\n    return binding;\n}\n\nfunction getDecoratedBindingFromBinding(binding) {\n    if (\n        binding.binding.TheClass &&\n        binding.binding.TheClass.__diska &&\n        binding.binding.TheClass.__diska.scope) {\n        return binding.binding.TheClass.__diska.scope;\n    } else {\n        return undefined;\n    }\n}\n\nfunction createImplicitBinding(type) {\n    if (typeof type === 'string') {\n        throw new Error('Failed when trying to inject argument ' + type + '. ' +\n            'You must either have an @Inject() decorator on owner class, or use module.bind() to ' +\n            'bind classes with names that match the constructor arguments.');\n    }\n    return {\n        binding : new ClassBinding(type)\n    };\n}\n\nfunction listContainsType(list:Array<any>, type:any):boolean {\n    for (var i = 0; i < list.length; i++) {\n        if (list[i] === type) {\n            return true;\n        }\n    }\n    return false;\n}\n\n"]}